jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",_self:"Same tab (default)",_blank:"New tab",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,svgAbsoluteUseHref:!1,hideButtonTexts:null},Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,hideButtonTexts:null,prefix:"trumbowyg-",tagClasses:{},semantic:!0,semanticKeepAttributes:!1,resetCss:!1,removeformatPasted:!1,tabToIndent:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},changeActiveDropdownIcon:!1,inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1,linkTargets:["_self","_blank"],svgPath:null},writable:!1,enumerable:!0,configurable:!1}),((l,d,c,u)=>{var g="tbwconfirm",h="tbwcancel",a=(u.fn.trumbowyg=function(e,t){var n="trumbowyg";if(e===Object(e)||!e)return this.each(function(){u(this).data(n)||u(this).data(n,new a(this,e))});if(1===this.length)try{var o=u(this).data(n);switch(e){case"execCmd":return o.execCmd(t.cmd,t.param,t.forceCss,t.skipTrumbowyg);case"openModal":return o.openModal(t.title,t.content);case"closeModal":return o.closeModal();case"openModalInsert":return o.openModalInsert(t.title,t.fields,t.callback);case"saveRange":return o.saveRange();case"getRange":return o.range;case"getRangeText":return o.getRangeText();case"restoreRange":return o.restoreRange();case"enable":return o.setDisabled(!1);case"disable":return o.setDisabled(!0);case"toggle":return o.toggle();case"destroy":return o.destroy();case"empty":return o.empty();case"html":return o.html(t)}}catch(e){}return!1},function(e,t){function n(){return(d.chrome||d.Intl&&Intl.v8BreakIterator)&&"CSS"in d}var o,a=this,i="trumbowyg-icons",r=u.trumbowyg,s=(a.doc=e.ownerDocument||c,a.$ta=u(e),a.$c=u(e),null!=(t=t||{}).lang||null!=r.langs[t.lang]?a.lang=u.extend(!0,{},r.langs.en,r.langs[t.lang]):a.lang=r.langs.en,a.hideButtonTexts=(null!=r.hideButtonTexts?r:t).hideButtonTexts,(null!=r.svgPath?r:t).svgPath),i=(a.hasSvg=!1!==s,!1===s||!r.svgAbsoluteUseHref&&0!==u("#"+i,a.doc).length||(null==s&&u("script[src]").each(function(e,t){var t=t.src,n=t.match("trumbowyg(.min)?.js");null!=n&&(s=t.substring(0,t.indexOf(n[0]))+"ui/icons.svg")}),null==s?console.warn("You must define svgPath: https://goo.gl/CfTY9U"):r.svgAbsoluteUseHref||((o=a.doc.createElement("div")).style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.visibility="hidden",o.id=i,a.doc.body.insertBefore(o,a.doc.body.childNodes[0]),fetch(s,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(e=>{e.text().then(e=>{o.innerHTML=e})}))),a.doc.querySelector("base")?d.location.href.replace(d.location.hash,""):""),i=(a.svgPath=r.svgAbsoluteUseHref?s:i,a.lang.header);a.btnsDef={viewHTML:{fn:"toggle",class:"trumbowyg-not-disable"},undo:{isSupported:n,key:"Z"},redo:{isSupported:n,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:i+" 1"},h2:{fn:"formatBlock",title:i+" 2"},h3:{fn:"formatBlock",title:i+" 3"},h4:{fn:"formatBlock",title:i+" 4"},h5:{fn:"formatBlock",title:i+" 5"},h6:{fn:"formatBlock",title:i+" 6"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},a.o=u.extend(!0,{},r.defaultOptions,t),a.o.hasOwnProperty("imgDblClickHandler")||(a.o.imgDblClickHandler=a.getDefaultImgDblClickHandler()),a.urlPrefix=a.setupUrlPrefix(),a.disabled=a.o.disabled||"TEXTAREA"===e.nodeName&&e.disabled,t.btns?a.o.btns=t.btns:a.o.semantic||(a.o.btns[3]=["bold","italic","underline","strikethrough"]),u.each(a.o.btnsDef,function(e,t){a.addBtnDef(e,t)}),a.eventNamespace="trumbowyg-event",a.keys=[],a.tagToButton={},a.tagHandlers=[],a.pasteHandlers=[].concat(a.o.pasteHandlers),a.isIE=-1!==l.userAgent.indexOf("MSIE")||-1!==l.appVersion.indexOf("Trident/"),a.isMac=-1!==l.platform.toUpperCase().indexOf("MAC"),a.init()});a.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p"},init:function(){var e=this;e.height=e.$ta.outerHeight()-39,e.initPlugins();try{e.doc.execCommand("enableObjectResizing",!1,!1),e.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){}e.buildEditor(),e.buildBtnPane(),e.fixedBtnPaneEvents(),e.buildOverlay(),setTimeout(function(){e.disabled&&e.setDisabled(!0),e.$c.trigger("tbwinit")})},addBtnDef:function(e,t){this.btnsDef[e]=u.extend(t,this.btnsDef[e]||{})},setupUrlPrefix:function(){var e=this.o.urlProtocol;if(e)return"string"!=typeof e?"https://":e.replace("://","")+"://"},buildEditor:function(){var t,o=this,n=o.o.prefix,e="",a=(o.$box=u("<div/>",{class:n+"box "+n+"editor-visible "+n+o.o.lang+" trumbowyg"}),o.$edBox=u("<div/>",{class:n+"editor-box"}),o.isTextarea=o.$ta.is("textarea"),o.isTextarea?(e=o.$ta.val(),o.$ed=u("<div/>").appendTo(o.$edBox),o.$box.insertAfter(o.$ta).append(o.$edBox,o.$ta)):(o.$ed=o.$ta,e=o.$ed.html(),o.$ta=u("<textarea/>",{name:o.$ta.attr("id"),height:o.height}).val(e),o.$box.insertAfter(o.$ed).append(o.$ta,o.$edBox),o.$edBox.append(o.$ed),o.syncCode()),o.$ta.addClass(n+"textarea").attr("tabindex",-1),o.$ed.addClass(n+"editor").attr({contenteditable:!0,dir:o.lang._dir||"ltr"}).html(e),o.o.tabindex&&o.$ed.attr("tabindex",o.o.tabindex),o.$c.is("[placeholder]")&&o.$ed.attr("placeholder",o.$c.attr("placeholder")),o.$c.is("[spellcheck]")&&o.$ed.attr("spellcheck",o.$c.attr("spellcheck")),o.o.resetCss&&o.$ed.addClass(n+"reset-css"),o.semanticCode(),o.applyTagClasses(),o.o.autogrowOnEnter&&o.$ed.addClass(n+"autogrow-on-enter"),!1),i=!1;o.$ed.on("dblclick","img",o.o.imgDblClickHandler).on("keydown",function(e){var t=e.which;if(8!==t&&13!==t&&46!==t||o.toggleSpan(!0),!e.ctrlKey&&!e.metaKey||e.altKey){if(o.o.tabToIndent&&"Tab"===e.key)try{return e.shiftKey?o.execCmd("outdent",!0,null):o.execCmd("indent",!0,null),!1}catch(e){}}else{a=!0;t=o.keys[String.fromCharCode(e.which).toUpperCase()];try{return o.execCmd(t.fn,t.param),!1}catch(e){}}}).on("compositionstart compositionupdate",function(){i=!0}).on("keyup compositionend",function(e){if("compositionend"===e.type)i=!1;else if(i)return;var t=e.which;37<=t&&t<=40||(8!==t&&13!==t&&46!==t||o.toggleSpan(),!e.ctrlKey&&!e.metaKey||89!==t&&90!==t?a||16===t||17===t?void 0===e.which&&o.semanticCode(!1,!1,!0):(e=!o.isIE||"compositionend"===e.type,o.semanticCode(!1,e&&13===t),o.$c.trigger("tbwchange")):(o.semanticCode(!1,!0),o.$c.trigger("tbwchange")),setTimeout(function(){a=!1},50))}).on("input",function(e){e=e.originalEvent;"object"==typeof e&&("insertReplacementText"===e.inputType||"insertText"===e.inputType&&null===e.data)&&o.$c.trigger("tbwchange")}).on("mouseup keydown keyup",function(e){(e.ctrlKey||e.metaKey)&&!e.altKey||setTimeout(function(){a=!1},50),clearTimeout(t),t=setTimeout(function(){o.updateButtonPaneStatus()},50)}).on("focus blur",function(e){"blur"===e.type&&o.clearButtonPaneStatus(),o.$c.trigger("tbw"+e.type),o.o.autogrowOnEnter&&!o.autogrowOnEnterDontClose&&("focus"===e.type?(o.autogrowOnEnterWasFocused=!0,o.autogrowEditorOnEnter()):o.o.autogrow||(o.$edBox.css({height:o.$edBox.css("min-height")}),o.$c.trigger("tbwresize")))}).on("keyup focus",function(){o.$ta.val().match(/<.*>/)||o.$ed.html().match(/<.*>/)||setTimeout(function(){var e=o.isIE?"<p>":"p";o.doc.execCommand("formatBlock",!1,e),o.syncCode()},0)}).on("cut drop",function(){setTimeout(function(){o.semanticCode(!1,!0),o.$c.trigger("tbwchange")},0)}).on("paste",function(n){if(o.o.removeformatPasted){n.preventDefault(),d.getSelection&&d.getSelection().deleteFromDocument&&d.getSelection().deleteFromDocument();try{var t=d.clipboardData.getData("Text");try{o.doc.selection.createRange().pasteHTML(t)}catch(e){o.doc.getSelection().getRangeAt(0).insertNode(o.doc.createTextNode(t))}o.$c.trigger("tbwchange",n)}catch(e){o.execCmd("insertText",(n.originalEvent||n).clipboardData.getData("text/plain"))}}u.each(o.pasteHandlers,function(e,t){t(n)}),setTimeout(function(){o.semanticCode(!1,!0),o.$c.trigger("tbwpaste",n),o.$c.trigger("tbwchange")},0)}),o.$ta.on("keyup",function(){o.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){o.$c.trigger("tbwchange")},0)}),u(o.doc.body).on("keydown."+o.eventNamespace,function(e){if(27===e.which&&1<=u("."+n+"modal-box").length)return o.closeModal(),!1})},autogrowEditorOnEnter:function(){var e=this,t=(e.$ed.removeClass("autogrow-on-enter"),e.$ed[0].clientHeight),n=(e.$edBox.height("auto"),e.$ed[0].scrollHeight);e.$ed.addClass("autogrow-on-enter"),t!==n&&(e.$edBox.height(t),setTimeout(function(){e.$edBox.css({height:n}),e.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var o=this,a=o.o.prefix,i=o.$btnPane=u("<div/>",{class:a+"button-pane"});u.each(o.o.btns,function(e,t){Array.isArray(t)||(t=[t]);var n=u("<div/>",{class:a+"button-group "+(0<=t.indexOf("fullscreen")?a+"right":"")});u.each(t,function(e,t){try{o.isSupportedBtn(t)&&n.append(o.buildBtn(t))}catch(e){}}),0<n.html().trim().length&&i.append(n)}),o.$box.prepend(i)},buildBtn:function(e){var t,n,o=this,a=o.o.prefix,i=o.btnsDef[e],r=i.dropdown,s=null==i.hasIcon||i.hasIcon,l=o.lang[e]||e,s=u("<button/>",{type:"button",class:a+e+"-button "+(i.class||"")+(s?"":" "+a+"textual-button"),html:o.hasSvg&&s?'<svg><use xlink:href="'+o.svgPath+"#"+a+(i.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':o.hideButtonTexts?"":i.text||i.title||o.lang[e]||e,title:(i.title||i.text||l)+(i.key?" ("+(o.isMac?"Cmd":"Ctrl")+" + "+i.key+")":""),tabindex:-1,mousedown:function(){return r&&!u("."+e+"-"+a+"dropdown",o.$box).is(":hidden")||u("body",o.doc).trigger("mousedown"),(!o.$btnPane.hasClass(a+"disable")&&!o.$box.hasClass(a+"disabled")||u(this).hasClass(a+"active")||u(this).hasClass(a+"not-disable"))&&o.execCmd((!r?i.fn:"dropdown")||e,i.param||e,i.forceCss),!1}});return r?(s.addClass(a+"open-dropdown"),(t={class:(l=a+"dropdown")+"-"+e+" "+l+" "+a+"fixed-top "+(i.dropdownClass||"")})["data-"+l]=e,n=u("<div/>",t),u.each(r,function(e,t){o.btnsDef[t]&&o.isSupportedBtn(t)&&n.append(o.buildSubBtn(t))}),o.$box.append(n.hide())):i.key&&(o.keys[i.key]={fn:i.fn||e,param:i.param||e}),r||(o.tagToButton[(i.tag||e).toLowerCase()]=e),s},buildSubBtn:function(e){var t=this,n=t.o.prefix,o=t.btnsDef[e],a=null==o.hasIcon||o.hasIcon;return o.key&&(t.keys[o.key]={fn:o.fn||e,param:o.param||e}),t.tagToButton[(o.tag||e).toLowerCase()]=e,u("<button/>",{type:"button",class:n+e+"-dropdown-button "+(o.class||"")+(o.ico?" "+n+o.ico+"-button":""),html:t.hasSvg&&a?'<svg><use xlink:href="'+t.svgPath+"#"+n+(o.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(o.text||o.title||t.lang[e]||e):o.text||o.title||t.lang[e]||e,title:o.key?"("+(t.isMac?"Cmd":"Ctrl")+" + "+o.key+")":null,style:o.style||null,mousedown:function(){return u("body",t.doc).trigger("mousedown"),t.execCmd(o.fn||e,o.param||e,o.forceCss),!1}})},isSupportedBtn:function(e){try{return this.btnsDef[e].isSupported()}catch(e){}return!0},buildOverlay:function(){return this.$overlay=u("<div/>",{class:this.o.prefix+"overlay"}).appendTo(this.$box),this.$overlay},showOverlay:function(){u(d).trigger("scroll"),this.$overlay.fadeIn(200),this.$box.addClass(this.o.prefix+"box-blur")},hideOverlay:function(){this.$overlay.fadeOut(50),this.$box.removeClass(this.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var a=this,i=a.o.fixedFullWidth,r=a.$box;a.o.fixedBtnPane&&(a.isFixed=!1,u(d).on("scroll."+a.eventNamespace+" resize."+a.eventNamespace,function(){var e,t,n,o;r&&(a.syncCode(),e=u(d).scrollTop(),t=r.offset().top+1,o=(n=a.$btnPane).outerHeight()-2,0<e-t&&e-t-a.height<0?(a.isFixed||(a.isFixed=!0,n.css({position:"fixed",top:0,left:i?0:"auto",zIndex:7}),a.$box.css({paddingTop:n.height()})),n.css({width:i?"100%":r.width()-1}),u("."+a.o.prefix+"fixed-top",r).css({position:i?"fixed":"absolute",top:i?o:e-t+o,zIndex:15})):a.isFixed&&(a.isFixed=!1,n.removeAttr("style"),a.$box.css({paddingTop:0}),u("."+a.o.prefix+"fixed-top",r).css({position:"absolute",top:o})))}))},setDisabled:function(e){var t=this,n=t.o.prefix;(t.disabled=e)?t.$ta.attr("disabled",!0):t.$ta.removeAttr("disabled"),t.$box.toggleClass(n+"disabled",e),t.$ed.attr("contenteditable",!e)},destroy:function(){var e=this,t=e.o.prefix;e.isTextarea?e.$box.after(e.$ta.css({height:""}).val(e.html()).removeClass(t+"textarea").show()):e.$box.after(e.$edBox.css({height:""}).removeClass(t+"editor").removeAttr("contenteditable").removeAttr("dir").html(e.html()).show()),e.$ed.off("dblclick","img"),e.destroyPlugins(),e.$box.remove(),e.$c.removeData("trumbowyg"),u("body").removeClass(t+"body-fullscreen"),e.$c.trigger("tbwclose"),u(d).off("scroll."+e.eventNamespace+" resize."+e.eventNamespace),u(e.doc.body).off("keydown."+e.eventNamespace)},empty:function(){this.doc.execCommand("insertHTML",!1,""),this.$ta.val(""),this.syncCode(!0)},toggle:function(){var e=this,t=e.o.prefix;e.o.autogrowOnEnter&&(e.autogrowOnEnterDontClose=!e.$box.hasClass(t+"editor-hidden")),e.semanticCode(!1,!0),e.$c.trigger("tbwchange"),setTimeout(function(){e.doc.activeElement.blur(),e.$box.toggleClass(t+"editor-hidden "+t+"editor-visible"),e.$btnPane.toggleClass(t+"disable"),u("."+t+"viewHTML-button",e.$btnPane).toggleClass(t+"active"),e.$box.hasClass(t+"editor-visible")?e.$ta.attr("tabindex",-1):e.$ta.removeAttr("tabindex"),e.o.autogrowOnEnter&&e.autogrowOnEnterDontClose},0)},toggleSpan:function(e){this.$ed.find("span").each(function(){!0===e?u(this).attr("data-tbw-flag",!0):u(this).attr("data-tbw-flag")?u(this).removeAttr("data-tbw-flag"):u(this).contents().unwrap()})},dropdown:function(e){var t=this,n=u("body",t.doc),o=t.o.prefix,a=u("[data-"+o+"dropdown="+e+"]",t.$box),e=u("."+o+e+"-button",t.$btnPane),i=a.is(":hidden");n.trigger("mousedown"),i&&(i=e.offset().left,e.addClass(o+"active"),a.css({position:"absolute",top:e.offset().top-t.$btnPane.offset().top+e.outerHeight(),left:t.o.fixedFullWidth&&t.isFixed?i:i-t.$btnPane.offset().left}).show(),u(d).trigger("scroll"),n.on("mousedown."+t.eventNamespace,function(e){a.is(e.target)||(u("."+o+"dropdown",t.$box).hide(),u("."+o+"active",t.$btnPane).removeClass(o+"active"),n.off("mousedown."+t.eventNamespace))}))},html:function(e){var t=this;return null!=e?(t.$ta.val(e),t.syncCode(!0),t.$c.trigger("tbwchange"),t):t.$ta.val()},syncTextarea:function(){var e=this;e.$ta.val(0<e.$ed.text().trim().length||0<e.$ed.find(e.o.tagsToKeep.join(",")).length?e.$ed.html():"")},syncCode:function(e){var t=this;!e&&t.$ed.is(":visible")?t.syncTextarea():(e=u("<div>").html(t.$ta.val()),e=u("<div>").append(e),u(t.o.tagsToRemove.join(","),e).remove(),t.$ed.html(e.contents().html())),t.o.autogrow&&(t.height=t.$edBox.height(),t.height!==t.$ta.css("height"))&&(t.$ta.css({height:t.height}),t.$c.trigger("tbwresize")),t.o.autogrowOnEnter&&(t.$edBox.height("auto"),(e=t.autogrowOnEnterWasFocused?t.$edBox[0].scrollHeight:t.$edBox.css("min-height"))!==t.$ta.css("height"))&&(t.$edBox.css({height:e}),t.$c.trigger("tbwresize"))},semanticCode:function(e,t,n){var o,a,i,r=this,e=(r.saveRange(),r.syncCode(e),!0);r.range&&r.range.collapsed&&(e=!1),r.o.semantic&&(r.semanticTag("b",r.o.semanticKeepAttributes),r.semanticTag("i",r.o.semanticKeepAttributes),r.semanticTag("s",r.o.semanticKeepAttributes),r.semanticTag("strike",r.o.semanticKeepAttributes),t&&(o=r.o.inlineElementsSelector,a=":not("+o+")",r.$ed.contents().filter(function(){return 3===this.nodeType&&0<this.nodeValue.trim().length}).wrap("<span data-tbw/>"),(i=function(e){var t;0!==e.length&&(t=(e=e.nextUntil(a).addBack().wrapAll("<p/>").parent()).nextAll(o).first(),e.next("br").remove(),i(t))})(r.$ed.children(o).first()),r.semanticTag("div",!0),u("[data-tbw]",r.$ed).contents().unwrap(),r.$ed.find("p:empty").remove()),!n&&e&&r.restoreRange(),r.syncTextarea())},semanticTag:function(e,o,t){var a,i=this,n=e;if(null!=this.o.semantic&&"object"==typeof this.o.semantic&&this.o.semantic.hasOwnProperty(e))a=this.o.semantic[e];else{if(!0!==this.o.semantic||!this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(e))return;a=this.DEFAULT_SEMANTIC_MAP[e]}t&&(e=a,a=n),u(e,this.$ed).each(function(){var e=!1,t=u(this);if(0===t.contents().length)return!1;i.range&&i.range.startContainer.parentNode===this&&(e=!0);var n=u("<"+a+"/>");n.insertBefore(t),o&&u.each(t.prop("attributes"),function(){n.attr(this.name,this.value)}),n.html(t.html()),t.remove(),!0===e&&(i.range.selectNodeContents(n.get(0)),i.range.collapse(!1))})},createLink:function(){for(var e,t,n,o=this,a=o.doc.getSelection(),i=a.getRangeAt(0),r=a.focusNode,i=(new XMLSerializer).serializeToString(i.cloneContents())||i+"",s=o.o.linkTargets[0];["A","DIV"].indexOf(r.nodeName)<0;)r=r.parentNode;r&&"A"===r.nodeName&&(i=(l=u(r)).text(),n=l.attr("href"),o.o.minimalLinks||(e=l.attr("title"),t=l.attr("target")||s),(l=o.doc.createRange()).selectNode(r),a.removeAllRanges(),a.addRange(l)),o.saveRange();var l,a={url:{label:o.lang.linkUrl||"URL",required:!0,value:n},text:{label:o.lang.text,value:i}};o.o.minimalLinks||(l=o.o.linkTargets.reduce(function(e,t){return e[t]=o.lang[t],e},{}),u.extend(a,{title:{label:o.lang.title,value:e},target:{label:o.lang.target,value:t,options:l}})),o.openModalInsert(o.lang.createLink,a,function(e){var t=o.prependUrlPrefix(e.url);return!!t.length&&(t=u(['<a href="',t,'">',e.text||e.url,"</a>"].join("")),e.title&&t.attr("title",e.title),(e.target||s)&&t.attr("target",e.target||s),o.range.deleteContents(),o.range.insertNode(t[0]),o.syncCode(),o.$c.trigger("tbwchange"),!0)})},prependUrlPrefix:function(e){return!this.urlPrefix||/^([a-z][-+.a-z0-9]*:|\/|#)/i.test(e)?e:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?"mailto:"+e:this.urlPrefix+e},unlink:function(){var e,t=this.doc.getSelection(),n=t.focusNode;if(t.isCollapsed){for(;["A","DIV"].indexOf(n.nodeName)<0;)n=n.parentNode;n&&"A"===n.nodeName&&((e=this.doc.createRange()).selectNode(n),t.removeAllRanges(),t.addRange(e))}this.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var n=this,e=(n.saveRange(),{url:{label:"URL",required:!0},alt:{label:n.lang.description,value:n.getRangeText()}});n.o.imageWidthModalEdit&&(e.width={}),n.openModalInsert(n.lang.insertImage,e,function(e){n.execCmd("insertImage",e.url,!1,!0);var t=u('img[src="'+e.url+'"]:not([alt])',n.$box);return t.attr("alt",e.alt),n.o.imageWidthModalEdit&&t.attr({width:e.width}),n.syncCode(),n.$c.trigger("tbwchange"),!0})},fullscreen:function(){var e=this,t=e.o.prefix,n=t+"fullscreen",o=n+"-placeholder",a=e.$box.outerHeight();e.$box.toggleClass(n),(n=e.$box.hasClass(n))?e.$box.before(u("<div/>",{class:o}).css({height:a})):u("."+o).remove(),u("body").toggleClass(t+"body-fullscreen",n),u(d).trigger("scroll"),e.$c.trigger("tbw"+(n?"open":"close")+"fullscreen")},applyTagClasses:function(){var e;for(e of Object.keys(this.o.tagClasses))u(e,this.$ed).addClass(this.o.tagClasses[e]);this.syncCode()},execCmd:function(t,n,e,o){var a=this;o=!!o||"","dropdown"!==t&&a.$ed.focus(),"strikethrough"===t&&a.o.semantic&&a.semanticTag("strike",a.o.semanticKeepAttributes,!0);try{a.doc.execCommand("styleWithCSS",!1,e||!1)}catch(e){}try{a[t+o](n)}catch(e){try{t(n)}catch(e){"insertHorizontalRule"===t?n=void 0:"formatBlock"===t&&a.isIE&&(n="<"+n+">"),a.doc.execCommand(t,!1,n),a.syncCode(),a.semanticCode(!1,!0)}"dropdown"!==t&&(a.updateButtonPaneStatus(),a.$c.trigger("tbwchange"))}try{a.applyTagClasses()}catch(e){}},openModal:function(e,t,n){var o=this,a=o.o.prefix;if(n=!1!==n,0<u("."+a+"modal-box",o.$box).length)return!1;o.o.autogrowOnEnter&&(o.autogrowOnEnterDontClose=!0),o.saveRange(),o.showOverlay(),o.$btnPane.addClass(a+"disable");var i=u("<div/>",{class:a+"modal "+a+"fixed-top"}).css({top:o.$box.offset().top+o.$btnPane.height(),zIndex:99999}).appendTo(u(o.doc.body)),r=a+"dark",t=(0!==o.$c.parents("."+r).length&&i.addClass(r),o.$overlay.one("click",function(){return i.trigger(h),!1}),r=n?u("<form/>",{action:"",html:t}).on("submit",function(){return i.trigger(g),!1}).on("reset",function(){return i.trigger(h),!1}).on("submit reset",function(){o.o.autogrowOnEnter&&(o.autogrowOnEnterDontClose=!1)}):t,u("<div/>",{class:a+"modal-box",html:r}).css({top:"-"+o.$btnPane.outerHeight(),opacity:0,paddingBottom:n?null:"5%"}).appendTo(i).animate({top:0,opacity:1},100));return e&&u("<span/>",{text:e,class:a+"modal-title"}).prependTo(t),n&&(u(":input:first",t).focus(),o.buildModalBtn("submit",t),o.buildModalBtn("reset",t),i.height(t.outerHeight()+10)),u(d).trigger("scroll"),o.$c.trigger("tbwmodalopen"),i},buildModalBtn:function(e,t){var n=this.o.prefix;return u("<button/>",{class:n+"modal-button "+n+"modal-"+e,type:e,text:this.lang[e]||e}).appendTo(u("form",t))},closeModal:function(){var e,t=this,n=t.o.prefix;t.$btnPane.hasClass(n+"disable")&&(t.$btnPane.removeClass(n+"disable"),t.$overlay.off(),(e=u("."+n+"modal-box",u(t.doc.body))).animate({top:"-"+e.height()},100,function(){e.parent().remove(),t.hideOverlay(),t.$c.trigger("tbwmodalclose")}),t.restoreRange())},openModalInsert:function(e,t,n){var s=this,r=s.o.prefix,l=s.lang,d="",c=r+"form-"+Date.now()+"-";return u.each(t,function(e,t){var n=t.label||e,o=t.name||e,a=t.attributes||{},e=c+e,i=Object.keys(a).map(function(e){return e+'="'+a[e]+'"'}).join(" ");"function"==typeof t.type?(t.name||(t.name=o),d+=t.type(t,e,r,l)):(d=(d=(d+='<div class="'+r+'input-row">')+'<div class="'+r+'input-infos"><label for="'+e+'"><span>'+(l[n]||n)+"</span></label></div>")+'<div class="'+r+'input-html">',d=u.isPlainObject(t.options)?(d+='<select id="'+e+'" name="'+o+'">')+Object.keys(t.options).map(e=>'<option value="'+e+'" '+(e===t.value?"selected":"")+">"+t.options[e]+"</option>").join("")+"</select>":(d+='<input id="'+e+'" type="'+(t.type||"text")+'" name="'+o+'" '+i)+("checkbox"===t.type&&t.value?' checked="checked"':"")+' value="'+(t.value||"").replace(/"/g,"&quot;")+'">',d+="</div></div>")}),s.openModal(e,d).on(g,function(){var a=u("form",u(this)),i=!0,r={};u.each(t,function(e,t){var n=t.name||e,o=u(':input[name="'+n+'"]',a);switch(o[0].type.toLowerCase()){case"checkbox":r[n]=o.is(":checked");break;case"radio":r[n]=o.filter(":checked").val();break;default:r[n]=o.val().trim()}t.required&&""===r[n]?(i=!1,s.addErrorOnModalField(o,s.lang.required)):t.pattern&&!t.pattern.test(r[n])&&(i=!1,s.addErrorOnModalField(o,t.patternError))}),i&&(s.restoreRange(),n(r,t))&&(s.syncCode(),s.$c.trigger("tbwchange"),s.closeModal(),u(this).off(g))}).one(h,function(){u(this).off(g),s.closeModal()})},addErrorOnModalField:function(e,t){var n=this.o.prefix,o=n+"msg-error",a=e.closest("."+n+"input-row");e.one("change keyup",function(){a.removeClass(n+"input-error")}),a.find("."+o).remove(),a.addClass(n+"input-error").find("."+n+"input-infos label").append(u("<span/>",{class:o,text:t}))},getDefaultImgDblClickHandler:function(){var o=this;return function(){var t=u(this),e=t.attr("src"),n="(Base64)",e={url:{label:"URL",value:e=0===e.indexOf("data:image")?n:e,required:!0},alt:{label:o.lang.description,value:t.attr("alt")}};return o.o.imageWidthModalEdit&&(e.width={value:t.attr("width")?t.attr("width"):""}),o.openModalInsert(o.lang.insertImage,e,function(e){return e.url!==n&&t.attr({src:e.url}),t.attr({alt:e.alt}),o.o.imageWidthModalEdit&&(0<parseInt(e.width)?t.attr({width:e.width}):t.removeAttr("width")),!0}),!1}},saveRange:function(){var e,t=this,n=t.doc.getSelection();t.range=null,n&&n.rangeCount&&(n=t.range=n.getRangeAt(0),(e=t.doc.createRange()).selectNodeContents(t.$ed[0]),e.setEnd(n.startContainer,n.startOffset),t.metaRange={start:t=(e+"").length,end:t+(n+"").length})},restoreRange:function(){var e=this,t=e.metaRange,n=e.range,o=e.doc.getSelection();if(n){if(t&&t.start!==t.end)for(var a,i=0,r=[e.$ed[0]],s=!1,l=!1,d=e.doc.createRange();!l&&(a=r.pop());)if(3===a.nodeType){var c=i+a.length;!s&&t.start>=i&&t.start<=c&&(d.setStart(a,t.start-i),s=!0),s&&t.end>=i&&t.end<=c&&(d.setEnd(a,t.end-i),l=!0),i=c}else for(var u=a.childNodes,g=u.length;0<g;)r.push(u[--g]);try{o.removeAllRanges()}catch(e){}o.addRange(d||n)}},getRangeText:function(){return this.range+""},clearButtonPaneStatus:function(){var e=this.o.prefix,t=e+"active-button "+e+"active",n=e+"original-icon";u("."+e+"active-button",this.$btnPane).removeClass(t),u("."+n,this.$btnPane).each(function(){u(this).find("svg use").attr("xlink:href",u(this).data(n))})},updateButtonPaneStatus:function(){var s=this,l=s.o.prefix,d=l+"active-button "+l+"active",c=l+"original-icon",e=s.getTagsRecursive(s.doc.getSelection().anchorNode);s.clearButtonPaneStatus(),u.each(e,function(e,t){t=s.tagToButton[t.toLowerCase()];if(0<(n=u("."+l+t+"-button",s.$btnPane)).length)n.addClass(d);else try{var n,o=(n=u("."+l+"dropdown ."+l+t+"-dropdown-button",s.$box)).find("svg use"),a=n.parent().data(l+"dropdown"),i=u("."+l+a+"-button",s.$box),r=i.find("svg use");i.addClass(d),s.o.changeActiveDropdownIcon&&0<o.length&&(i.addClass(c).data(c,r.attr("xlink:href")),r.attr("xlink:href",o.attr("xlink:href")))}catch(e){}})},getTagsRecursive:function(n,o){var e,a=this;return o=o||(n&&n.tagName?[n.tagName]:[]),!n||!n.parentNode||"DIV"===(e=(n=n.nodeType!==Node.ELEMENT_NODE?n.parentNode:n).tagName)?o:("P"===e&&""!==n.style.textAlign&&o.push(n.style.textAlign),u.each(a.tagHandlers,function(e,t){o=o.concat(t(n,a))}),o.push(e),a.getTagsRecursive(n.parentNode,o).filter(function(e){return null!=e}))},initPlugins:function(){var n=this;n.loadedPlugins=[],u.each(u.trumbowyg.plugins,function(e,t){t.shouldInit&&!t.shouldInit(n)||(t.init(n),t.tagHandler&&n.tagHandlers.push(t.tagHandler),n.loadedPlugins.push(t))})},destroyPlugins:function(){var n=this;u.each(this.loadedPlugins,function(e,t){t.destroy&&t.destroy(n)})}}})(navigator,window,document,jQuery);